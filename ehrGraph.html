<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="assets/styles/style.css">
</head>


<body>
    <div class="container">
        <h1 class="main-title">Data Visualization and D3.js</h1>
        <h2> Medical Doctors and the usage of Electronic Health Records in 2015</h2>
        <p> Understand how doctors across the United States use EHR. Basic EHR includes some of the following capabilities: patient demographics, patient problem lists, electronic lists of medication taken by patients, clinical notes, orders for medications, viewing lab results, and viewing imaging results.</p>

        <svg class="chart" width="420" height="120">
        </svg>
    </div>
    <!--- scripts -->
    <!--<script src="assets/js/d3.min.js"></script>-->
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="assets/js/ehrgraph.js"></script>
    <script type="text/javascript">
    //set up access data 
    //call data module 

    var width = 420,
        barHeight = 20;

    //scale y-axis for display 
    var x = d3.scale.linear()
        .range([0, width]);

    var chart = d3.select(".chart")
        .attr("width", width)

    var states = [];


    d3.json("assets/data/ehr.json", function(err, data) {
        if (err) {
            console.log(err);
        }

        console.log("Length of data: " + data.length);

        for (var i = 0; i < data.length; i++) {
            console.log(data[i]);
            var stateData = {};
            if (data[i]["period"] == "2015" && !(data[i]["region"] in states)) {
                states.push({
                    year: data[i]["period"],
                    state: data[i]["region"],
                    basicEHR: data[i]["pct_phys_basic_ehr"]
                });
            }
        }

        //debugging 
        for (var i = 0; i < states.length; i++)
            console.log(states[i]);


        x.domain([0, d3.max(states, function(data) {
            console.log(data.basicEHR);
            return data.basicEHR;
        })]);

        chart.attr("height", barHeight * states.length);

        //group all the state elements 
        var bar = chart.selectAll("g")
            .data(states)
            .enter().append("g")
            .attr("transform", function(dataPoint, i) {
                console.log("data" + dataPoint.basicEHR);
                console.log("i:" + i);
                return "translate(0," + i * barHeight + ")";
            });

         bar.append("rect")
             .attr("width", function(d) {
                console.log("appending bar to rectangle" + d.basicEHR);
                 return x(d.basicEHR);
             })
             .attr("height", barHeight - 1);

         bar.append("text")
             .attr("x", function(d) {
                 return x(d.basicEHR) - 3;
             })
             .attr('y', barHeight / 2)
             .attr('dy', '.35em')
             .text(function(d) {
                 return d.state;
             });

    });
    </script>
</body>

</html>
